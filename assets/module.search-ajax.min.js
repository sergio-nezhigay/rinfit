theme.SearchAjax=function(){function e(){this.selectors={search:".js-search-ajax"},this.load()}e.prototype=$.extend({},e.prototype,{load:function(){function e(e,t,a){if(a.count>0){var s=$($("#template-search-ajax")[0].content),n=$(document.createDocumentFragment()),r=+e.attr("data-js-max-products")-1;$.each(a.results,function(e){var t=s.clone(),a=t.find(".product-search-2__image img"),c=t.find(".product-search-2__title a"),o=t.find(".product-search-2__price .price"),i=t.find("a");return i.attr("href",this.url),c.html(this.title),a.attr("srcset",this.thumbnail+" 1x, "+this.thumbnail2x+" 2x"),this.price?theme.ProductCurrency.setPrice(o,this.price,this.compare_at_price):o.remove(),n.append(t),e<r}),t.html(""),t.append(n),theme.ImagesLazyLoad.update(),theme.ProductCurrency.update()}else t.html("");t[a.count>0?"removeClass":"addClass"]("d-none-important")}function t(t,s,n,r){var c=t.find(".search-ajax__result"),o=t.find(".search-ajax__view-all"),i=o.find("a"),d=t.find(".search-ajax__empty");i.attr("href","/search?q="+n),o[r.count>0?"removeClass":"addClass"]("d-none-important"),d[""===n||r.count>0?"addClass":"removeClass"]("d-none-important"),c.addClass("invisible"),e(t,c,r),c.removeClass("invisible"),theme.Loader.unset(s),t.find('button[type="submit"]').removeClass("disabled"),t.addClass("open"),$body.unbind("click.search-ajax"),$window.unbind("scroll.search-ajax"),$body.on("click.search-ajax",function(e){$(e.target).parents(".js-search-ajax").length||(a(),$body.unbind("click.search-ajax"))}),$window.on("scroll.search-ajax",function(){a(),$window.unbind("scroll.search-ajax")})}function a(e){var a=e||$(n.selectors.search),s=a.find(".search-ajax__content");r="",a.find("input").val(""),t(a,s,r,{count:0}),a.removeClass("open")}var s,n=this,r="";$body.on("keyup",this.selectors.search+" input",$.debounce(500,function(e){var a=$(this).parents(n.selectors.search);if(27!==e.keyCode){var c=$(this),o=c.val(),i=a.find(".search-ajax__content");o!==r&&(r=o,""===r?t(a,i,r,{count:0}):(s&&s.abort(),theme.Loader.set(i),a.find('button[type="submit"]').addClass("disabled"),s=$.getJSON({url:"/search",type:"POST",data:{q:r,view:"json-2"},success:function(e){t(a,i,r,e)}})))}})),$body.on("keyup",this.selectors.search+" input",function(e){if(27===e.keyCode){var a=$(this).parents(n.selectors.search),s=a.find(".search-ajax__content");r="",t(a,s,r,{count:0})}}),$body.on("clear",this.selectors.search,function(){a($(this))})},closeAll:function(){$(this.selectors.search+".open").trigger("clear")}}),theme.SearchAjax=new e},$(function(){theme.SearchAjax()});