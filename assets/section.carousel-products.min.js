theme.CarouselProducts=function(){function t(t){this.$container=$(t),this.namespace=".carousel-products",this.onLoad()}return t.prototype=$.extend({},Section.prototype,t.prototype,{_checkProduct:function(t,e){var a=this,o=t.attr("data-handle");return!!o&&(e&&e(t),$.ajax({type:"GET",url:"https://"+window.location.hostname+"/products/"+o,data:{view:"collection"},cache:!1,dataType:"html",success:function(e){var i=$(e).clone();i.find("img").one("load",function(){t.add(a.$slick.find('.slick-cloned[data-handle="'+o+'"]')).html(i).removeAttr("data-handle"),theme.ImagesLazyLoad.update()}),t.trigger("loaded")}}),!0)},initCarousel:function(){function t(){var t=0;i.find(".carousel__item img").each(function(){t=Math.max(t,$(this).innerHeight())}),u.css({top:t/2})}function e(){i.one("init",function(){v&&t(),$(window).trigger("checkImages"),o.removeClass("invisible"),theme.Loader.unset(o.parent())}),i.on("beforeChange",function(t,e,o,n){function s(t){d.unbind("loaded"),t.one("loaded",function(){theme.ProductReview.update()})}var r=n-1,c=n+h;a._checkProduct(i.find('[data-slick-index="'+r+'"]'),s);for(var l=c;l>o+1;l--)a._checkProduct(i.find('[data-slick-index="'+l+'"]'),s)}),i.on("afterChange",function(){theme.Tooltip&&theme.Tooltip.init()}),i.slick({lazyLoad:!1,arrows:v,prevArrow:c,nextArrow:l,dots:g,dotsClass:"slick-dots d-flex flex-wrap flex-center list-unstyled mt-7",adaptiveHeight:!0,autoplay:m,autoplaySpeed:p,infinite:f,slidesToShow:h,slidesToScroll:h,rtl:theme.rtl,responsive:[{breakpoint:theme.breakpoints.values.xl,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:theme.breakpoints.values.md,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:theme.breakpoints.values.sm,settings:{slidesToShow:2,slidesToScroll:2}}]})}var a=this,o=this.$container.find("[data-js-carousel]"),i=this.$container.find("[data-js-carousel-slick]"),n=this.$container.find("[data-carousel-control]"),s=this.$container.find("[data-carousel-items]"),r=null;if(this.$control=n,i.length){var d=i.find("> *"),c=o.find("[data-js-carousel-prev]"),l=o.find("[data-js-carousel-next]"),u=c.add(l),h=+o.attr("data-count"),m="true"===o.attr("data-autoplay"),p=+o.attr("data-speed")||0,f="true"===o.attr("data-infinite"),v="true"===o.attr("data-arrows"),g="true"===o.attr("data-bullets");this.$slick=i,v&&$window.on("theme.resize.carousel-products",t),e(),n.on("click","a",function(t){var a=$(this);if(!a.hasClass("active")){r&&r.abort(),theme.Loader.set(o),o.css({"min-height":s.innerHeight()});var c=a.attr("data-collection");r=$.ajax({type:"GET",url:"/collections/"+c,cache:!1,data:{view:"carousel",constraint:"max_count="+s.attr("data-max-count")+"+products_pre_row="+s.attr("data-products-pre-row")+"+async_ajax_loading="+s.attr("data-async-ajax-loading")},dataType:"html",success:function(t){o.addClass("invisible"),i.slick("destroy").off(),i.one("init",function(){o.removeAttr("style"),theme.Loader.unset(o)}),s.html(t),d=i.find("> *"),e(),theme.ImagesLazyLoad.update(),theme.ProductReview.update(),theme.Tooltip&&theme.Tooltip.init(),n.find("a").removeClass("active"),a.addClass("active"),r=null}})}return t.preventDefault(),!1}),theme.is_loaded&&(theme.ImagesLazyLoad.update(),theme.ProductReview.update(),theme.Tooltip&&theme.Tooltip.init())}},onLoad:function(){var t,e,a=this,o=this.$container.find(".product-recommendations");o.length?(t=o.attr("data-product-id"),e=o.attr("data-limit"),$.ajax({type:"GET",url:"/recommendations/products",data:{section_id:"carousel-related-products",product_id:t,limit:e},success:function(t){o.html($(t).find(".product-recommendations").html()),a.initCarousel()}})):this.initCarousel()},onUnload:function(){this.$container.off(this.namespace),this.$slick&&(this.$slick.slick("destroy").off(),this.$slick=null,$window.unbind("theme.resize.carousel-products")),this.$control.off(),theme.Tooltip&&theme.Tooltip.destroy()}}),t}(),$(function(){theme.sections.register("carousel-products",theme.CarouselProducts)});